# 多线程顺序消费
参考自 [一看就会的kafka多线程顺序消费【内附Demo哦】](https://juejin.cn/post/7055156612528341022)

## 背景
- 业务中使用ES物品库来存储推荐物品，物品从上游不断推入kafka，物品库的入库服务进行消费。  
- 物品有ID作为唯一性标识，当上游推入同一个ID的物品，视为进行修改，修改为局部字段更新。
- 入库服务中有过滤，校验，填充，打标，存储5个环节，其中打标环节最为耗时，一个物品需要调用多个算法标签接口，返回结果后对物品进行打标
- 物品入池kafka消费者配置为，一次批量消费10个消息（物品），同步处理（直接开多线程会有更新顺序的问题）

## 需求
- 物品池一天入库物品为30W，峰值消费延迟较为严重，能达到15分钟到20分钟，根据ELK日志判断，算法打标接口较为耗时；另外入库存储是第二耗时
